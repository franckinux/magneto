{% extends "base.html" %}
{% block title %}{{ _("Programmation d'un enregistrement") }}{% endblock %}

{% block styles %}
{{ super() }}
<link href="/static/gijgo/css/gijgo.min.css" rel="stylesheet" type="text/css">
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="/static/gijgo/js/gijgo.min.js" type="text/javascript"></script>
<script src="/static/gijgo/js/messages/messages.fr-fr.min.js" type="text/javascript"></script>
{% endblock %}

{% block page_content %}

<div class="container">
  <ul class="nav nav-tabs" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#schedule" role="tab" aria-controls="schedule" aria-selected="true">{{ _("Programmation") }}</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#list" role="tab" aria-controls="list" aria-selected="false">{{ _("Liste") }} </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#wakeup" role="tab" aria-controls="wakeup" aria-selected="false">{{ _("Réveils") }} </a>
    </li>
  </ul>

  <div class="tab-content">
    <div id="schedule" class="tab-pane fade show active" role="tabpanel" aria-labelledby="schedule-tab">
        <h2>{{ _("Programmation d'un enregistrement") }}</h2>
        <form method="POST" action="{{ url("index") }}" role="form">
            <div class="form-group">
                {{ form.adapter.label(for="adapter") }}
                {{ form.adapter(class="form-control") }}
                {% if form.adapter.errors %}
                <div class="help-text">
                    {% for error in form.adapter.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="form-group">
                {{ form.channel.label(for="channel") }}
                {{ form.channel(class="form-control") }}
                {% if form.channel.errors %}
                <div class="help-text">
                    {% for error in form.channel.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="form-group{% if form.program_name.errors %} has-error{% endif %}">
                {{ form.program_name.label(for="program_name") }}
                {{ form.program_name(class="form-control") }}
                {% if form.program_name.errors %}
                <div class="help-text">
                    {% for error in form.program_name.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
                {% endif %}
            </div>
            <div class="form-group{% if form.begin_date.errors %} has-error{% endif %}">
                {{ form.begin_date.label(for="begin_date") }}
                {% if form.begin_date.data is none %}
                <input id="begin_date" name="begin_date" width="100%" placeholder="{{ _("Entrez la date de début") }}" />
                {% else %}
                <input id="begin_date" name="begin_date" width="100%" value="{{ form.begin_date.data.strftime("%d-%m-%Y %H:%M") }}" />
                {% endif %}
                <div class="help-text">
                    {% for error in form.begin_date.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
            </div>
            <div class="form-group{% if form.end_date.errors %} has-error{% endif %}">
                {{ form.end_date.label(for="end_date") }}
                {% if form.end_date.data is none %}
                <input id="end_date" name="end_date" width="100%" placeholder="{{ _("Entrez la date de fin") }}"  />
                {% else %}
                <input id="end_date" name="end_date" width="100%" value="{{ form.end_date.data.strftime("%d-%m-%Y %H:%M") }}" />
                {% endif %}
                <div class="help-text">
                    {% for error in form.end_date.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
            </div>
            <div class="form-check">
                {{ form.shutdown(class="form-check-input") }}
                {{ form.shutdown.label(for="shutdown") }}
            </div>
            <div>
                {{ form.submit(class="btn btn-primary") }}
                <a href="{{ url("index") }}" class="btn btn-light">{{ _("Annuler") }}</a>
            </div>
        </form>
    </div>

    <div id="list" class="tab-pane fade" role="tabpanel" aria-labelledby="list-tab">
        <h2>{{ _("Liste des enregistrements") }}</h2>
        <table class="table">
        <thead>
            <tr>
                <td>{{ _("Nom du programme") }}</td>
                <td>{{ _("Chaîne") }}</td>
                <td>{{ _("Date de début") }}</td>
                <td>{{ _("Date de fin") }}</td>
                <td>{{ _("Enregistreur") }}</td>
                <td>{{ _("Extinction") }}</td>
                <td></td>
            </tr>
        </thead>
        <tbody>
            {% for id, rec in recordings.items() %}
            <tr>
                <td>{{ rec.program_name }}</td>
                <td>{{ rec.channel }}</td>
                <td>{{ rec.begin_date.strftime("%d/%m/%Y %H:%M") }}</td>
                <td>{{ rec.end_date.strftime("%d/%m/%Y %H:%M") }}</td>
                <td>{{ rec.adapter }}</td>
                <td>{{ rec.shutdown }}</td>
                <td><a href="{{ url("cancel_recording", id=id) }}">{{ _("Annuler") }}</a></td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
    </div>

    <div id="wakeup" class="tab-pane fade" role="tabpanel" aria-labelledby="wakeup-tab">
        <h2>{{ _("Programmation d'un réveil") }}</h2>
        <form method="POST" action="{{ url("index") }}" role="form">
            <div class="form-group{% if form2.wakeup_date.errors %} has-error{% endif %}">
                {{ form2.wakeup_date.label(for="wakeup_date") }}
                {% if form2.wakeup_date.data is none %}
                <input id="wakeup_date" name="wakeup_date" width="100%" placeholder="{{ _("Entrez la date de réveil") }}" />
                {% else %}
                <input id="wakeup_date" name="wakeup_date" width="100%" value="{{ form2.wakeup_date.data.strftime("%d-%m-%Y %H:%M") }}" />
                {% endif %}
                <div class="help-text">
                    {% for error in form2.wakeup_date.errors %}<p>{{ error }}</p>{% endfor %}
                </div>
            </div>
            <div>
                {{ form2.submit2(class="btn btn-primary") }}
                <a href="{{ url("index") }}" class="btn btn-light">{{ _("Annuler") }}</a>
            </div>
        </form>

        {% if wakeups %}
        <h2>{{ _("Liste des réveils") }}</h2>
        <table class="table">
        <thead>
            <tr>
                <td>{{ _("Date") }}</td>
                <td></td>
            </tr>
        </thead>
        <tbody>
            {% for id, wak in wakeups.items() %}
            <tr>
                <td>{{ wak.strftime("%d/%m/%Y %H:%M") }}</td>
                <td><a href="{{ url("cancel_wakeup", id=id) }}">{{ _("Annuler") }}</a></td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
        {% endif %}
    </div>

  </div>
</div>

<script>
    $('#begin_date').datetimepicker({
        format: "dd-mm-yyyy HH:MM",
        modal: true,
        footer: true,
        uiLibrary: "bootstrap4",
        locale: "fr-fr",
        minDate: Date.now(),
        weekStartDay: 1
    });
    $('#end_date').datetimepicker({
        format: "dd-mm-yyyy HH:MM",
        modal: true,
        footer: true,
        uiLibrary: "bootstrap4",
        locale: "fr-fr",
        minDate: Date.now(),
        weekStartDay: 1
    });
    $('#wakeup_date').datetimepicker({
        format: "dd-mm-yyyy HH:MM",
        modal: true,
        footer: true,
        uiLibrary: "bootstrap4",
        locale: "fr-fr",
        minDate: Date.now(),
        weekStartDay: 1
    });
</script>
{% endblock %}
